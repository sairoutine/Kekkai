!function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){"use strict";var n={TILE_SIZE:24,BLOCK_GREEN:1,BLOCK_BLUE:2,BLOCK_RED:3,BLOCK_PURPLE:4,BLOCK_BROWN:5,LADDER:6,PLAYER:7,ENEMY:8,ITEM:9};e.exports=n},{}],2:[function(t,e,i){"use strict";var n=t("./hakurei").core,r=t("./hakurei").util,o=t("./scene/loading"),s=t("./scene/title"),a=t("./scene/stage"),h=function(t){n.apply(this,arguments)};r.inherit(h,n),h.prototype.init=function(){n.prototype.init.apply(this,arguments),this.addScene("loading",new o(this)),this.addScene("title",new s(this)),this.addScene("stage",new a(this)),this.changeScene("loading")},e.exports=h},{"./hakurei":3,"./scene/loading":28,"./scene/stage":30,"./scene/title":33}],3:[function(t,e,i){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":7}],4:[function(t,e,i){"use strict";var n=function(t){this.images={},this.loading_image_num=0,this.loaded_image_num=0};n.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},n.prototype.loadImage=function(t,e){var i=this;i.loading_image_num++;var n=function(){i.loaded_image_num++},r=new Image;r.src=e,r.onload=n,this.images[t]=r},n.prototype.isAllLoaded=function(){return this.loaded_image_num>0&&this.loaded_image_num===this.loading_image_num},n.prototype.getImage=function(t){return this.images[t]},e.exports=n},{}],5:[function(t,e,i){"use strict";var n={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=n},{}],6:[function(t,e,i){"use strict";var n=t("./constant"),r=t("./asset_loader/image"),o=function(t){this.ctx=t.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.current_scene=null,this._reserved_next_scene=null,this.scenes={},this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader=new r};o.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader.init()},o.prototype.enableGamePad=function(){this.is_connect_gamepad=!0},o.prototype.isRunning=function(){return this.request_id?!0:!1},o.prototype.startRun=function(){this.isRunning()||this.run()},o.prototype.run=function(){this.handleGamePad(),this.changeNextSceneIfReserved();var t=this.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw()),this.before_keyflag=this.current_keyflag,this.frame_count++,this.request_id=requestAnimationFrame(this.run.bind(this))},o.prototype.currentScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},o.prototype.addScene=function(t,e){this.scenes[t]=e},o.prototype.changeScene=function(t){this._reserved_next_scene=t},o.prototype.changeNextSceneIfReserved=function(){this._reserved_next_scene&&(this.current_scene=this._reserved_next_scene,this.currentScene().init(),this._reserved_next_scene=null)},o.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.width,this.height)},o.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},o.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},o.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},o.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},o.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=n.BUTTON_SHIFT;break;case 32:e=n.BUTTON_SPACE;break;case 37:e=n.BUTTON_LEFT;break;case 38:e=n.BUTTON_UP;break;case 39:e=n.BUTTON_RIGHT;break;case 40:e=n.BUTTON_DOWN;break;case 88:e=n.BUTTON_X;break;case 90:e=n.BUTTON_Z}return e},o.prototype.handleGamePad=function(){if(this.is_connect_gamepad){var t=navigator.getGamepads(),e=t[0];e&&(this.current_keyflag=0,this.current_keyflag|=e.buttons[1].pressed?n.BUTTON_Z:0,this.current_keyflag|=e.buttons[0].pressed?n.BUTTON_X:0,this.current_keyflag|=e.buttons[2].pressed?n.BUTTON_SELECT:0,this.current_keyflag|=e.buttons[3].pressed?n.BUTTON_START:0,this.current_keyflag|=e.buttons[4].pressed?n.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[5].pressed?n.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[6].pressed?n.BUTTON_SPACE:0,this.current_keyflag|=e.axes[1]<-.5?n.BUTTON_UP:0,this.current_keyflag|=e.axes[1]>.5?n.BUTTON_DOWN:0,this.current_keyflag|=e.axes[0]<-.5?n.BUTTON_LEFT:0,this.current_keyflag|=e.axes[0]>.5?n.BUTTON_RIGHT:0)}},e.exports=o},{"./asset_loader/image":4,"./constant":5}],7:[function(t,e,i){"use strict";e.exports={util:t("./util"),core:t("./core"),constant:t("./constant"),scene:{base:t("./scene/base")},object:{base:t("./object/base"),sprite:t("./object/sprite"),pool_manager:t("./object/pool_manager")},asset_loader:{image:t("./asset_loader/image")}}},{"./asset_loader/image":4,"./constant":5,"./core":6,"./object/base":8,"./object/pool_manager":9,"./object/sprite":10,"./scene/base":11,"./util":12}],8:[function(t,e,i){"use strict";var n=t("../util"),r=0,o=function(t,e){this.scene=t,this.core=t.core,this.parent=e,this.id=++r,this.frame_count=0,this.x=0,this.y=0,this.auto_disable_times_map={},this.velocity={magnitude:0,theta:0},this.objects=[]};o.prototype.init=function(){this.frame_count=0,this.x=0,this.y=0,this.auto_disable_times_map={};for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},o.prototype.beforeDraw=function(){this.frame_count++,this.checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.move()},o.prototype.draw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw()},o.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},o.prototype.addSubObject=function(t){this.objects.push(t)},o.prototype.removeSubObject=function(t){for(var e=0,i=this.objects.length;i>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},o.prototype.move=function(){var t=n.calcMoveXByVelocity(this.velocity),e=n.calcMoveYByVelocity(this.velocity);this.x+=t,this.y+=e},o.prototype.onCollision=function(){},o.prototype.width=function(){return 0},o.prototype.height=function(){return 0},o.prototype.globalCenterX=function(){return this.scene.x+this.x},o.prototype.globalCenterY=function(){return this.scene.y+this.y},o.prototype.globalLeftX=function(){return this.scene.x+this.x-this.width()/2},o.prototype.globalRightX=function(){return this.scene.x+this.x+this.width()/2},o.prototype.globalUpY=function(){return this.scene.x+this.y-this.height()/2},o.prototype.globalDownY=function(){return this.scene.x+this.y+this.height()/2},o.prototype.collisionWidth=function(){return 0},o.prototype.collisionHeight=function(){return 0},o.prototype.checkCollisionWithObject=function(t){var e=this;t.checkCollision(e)&&(t.onCollision(e),e.onCollision(t))},o.prototype.checkCollisionWithObjects=function(t){for(var e=this,i=0;i<t.length;i++){var n=t[i];e.checkCollision(n)&&(e.onCollision(n),n.onCollision(e))}},o.prototype.checkCollision=function(t){return Math.abs(this.x-t.x)<this.collisionWidth()/2+t.collisionWidth()/2&&Math.abs(this.y-t.y)<this.collisionHeight()/2+t.collisionHeight()/2?!0:!1},o.prototype.getCollisionLeftX=function(){return this.x-this.collisionWidth()/2},o.prototype.getCollisionUpY=function(){return this.y-this.collisionHeight()/2},o.prototype.setAutoDisableFlag=function(t,e){var i=this;i[t]=!0,i.auto_disable_times_map[t]=i.frame_count+e},o.prototype.checkAutoDisableFlags=function(){var t=this;for(var e in t.auto_disable_times_map)this.auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t.auto_disable_times_map[e])},o.prototype.setVelocity=function(t){this.velocity=t},e.exports=o},{"../util":12}],9:[function(t,e,i){"use strict";var n=t("./base"),r=t("../util"),o=function(t,e){n.apply(this,arguments),this.Class=e,this.objects={}};r.inherit(o,n),o.prototype.init=function(){n.prototype.init.apply(this,arguments),this.objects={}},o.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},o.prototype.draw=function(){n.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},o.prototype.afterDraw=function(){n.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},o.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},o.prototype.remove=function(t){delete this.objects[t]},o.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var i=this.objects[e];t.checkCollision(i)&&(t.onCollision(i),i.onCollision(t))}},o.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var n=this.objects[e],r=t.objects[i];if(n.onCollision(r),r.onCollision(n),!this.objects[e])break}},e.exports=o},{"../util":12,"./base":8}],10:[function(t,e,i){"use strict";var n=t("./base"),r=t("../util"),o=function(t){n.apply(this,arguments),this.current_sprite_index=0};r.inherit(o,n),o.prototype.init=function(){n.prototype.init.apply(this,arguments),this.current_sprite_index=0},o.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},o.prototype.draw=function(){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var i=r.thetaToRadian(this.velocity.theta+this.rotateAdjust());e.rotate(i);var o=this.spriteWidth(),s=this.spriteHeight();o||(o=t.width),s||(s=t.height);var a=o*this.scaleWidth(),h=s*this.scaleHeight();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.drawImage(t,o*this.spriteIndexX(),s*this.spriteIndexY(),o,s,-a/2,-h/2,a,h),e.restore(),n.prototype.draw.apply(this,arguments)},o.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},o.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},o.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},o.prototype.spriteAnimationSpan=function(){return 0},o.prototype.spriteIndices=function(){return[{x:0,y:0}]},o.prototype.spriteWidth=function(){return 0},o.prototype.spriteHeight=function(){return 0},o.prototype.rotateAdjust=function(){return 0},o.prototype.scale=function(){return 0},o.prototype.scaleWidth=function(){return 1},o.prototype.scaleHeight=function(){return 1},o.prototype.isReflect=function(){return!1},e.exports=o},{"../util":12,"./base":8}],11:[function(t,e,i){"use strict";var n=function(t,e){this.core=t,this.parent=e,this.width=this.core.width,this.height=this.core.height,this.x=0,this.y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this.scenes={}};n.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.x=0,this.y=0,this.frame_count=0;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},n.prototype.beforeDraw=function(){this.frame_count++,this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw()},n.prototype.draw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},n.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},n.prototype.addObject=function(t){this.objects.push(t)},n.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},n.prototype.addSubScene=function(t,e){this.scenes[t]=e},n.prototype.changeSubScene=function(t){this._reserved_next_scene=t},n.prototype.changeNextSubSceneIfReserved=function(){this._reserved_next_scene&&(this.current_scene=this._reserved_next_scene,this.currentSubScene().init(),this._reserved_next_scene=null)},e.exports=n},{}],12:[function(t,e,i){"use strict";var n={inherit:function(t,e){var i=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=i(e.prototype),t.prototype.constructor=t},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(n.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(n.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,i=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return"rgb("+i+", "+n+", "+r+")"}};e.exports=n},{}],13:[function(t,e,i){"use strict";var n=[{pos:"left",exp:"normal",chara:"reimu",fukidashi:"normal",serif:"いたた..."},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"あらあら"},{pos:"left",exp:"normal",chara:"reimu",fukidashi:"normal",serif:"あ、ゆかり"},{pos:"left",exp:"angry",chara:"reimu",fukidashi:"normal",serif:"またアンタのしわざね"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"暇そうにしてたから♪"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"それよりほら、見て"},{pos:"left",exp:"angry",chara:"reimu",fukidashi:"normal",serif:"なによ"},{pos:"left",exp:"laugh2",chara:"reimu",fukidashi:"normal",serif:"あ、お金！"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"せっかくだから、拾って帰りましょう"},{pos:"left",exp:"normal",chara:"reimu",fukidashi:"normal",serif:"取れない場所にもあるわ"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"わたしも手伝ってあげるわよ"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"Zボタンで私と霊夢の位置を入れかえることができるわ"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"私は霊夢と反対の位置にいるから"},{pos:"left",exp:"normal",chara:"reimu",fukidashi:"normal",serif:"Xボタンね"},{pos:"right",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"ステージにあるお金を全部取れたら、帰れるわよ"}];e.exports=n},{}],14:[function(t,e,i){"use strict";var n=function(t){this.timeoutID=null,this.script=t,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[]};n.prototype.init=function(){this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[],this.is_end()||this.next()},n.prototype.is_end=function(){return this.progress+1===this.script.length},n.prototype.next=function(){this.progress++;var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},n.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},n.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var i=t.split(""),n=i.length,r=0;e.line_num=0,e.printing_lines=[];var o=function(){if(!(r>=n)){var t=10,s=i[r];r++,"\n"===s?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+s),e.timeoutID=setTimeout(o,t)}};o()},n.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},n.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},n.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},n.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},n.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},n.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},n.prototype.lines=function(){return this.printing_lines},e.exports=n},{}],15:[function(t,e,i){"use strict";var n=t("./game");window.AudioContext=window.AudioContext||window.webkitAudioContext;var r;window.onload=function(){var t=document.getElementById("mainCanvas");r=new n(t),r.init(),window.onkeydown=function(t){r.handleKeyDown(t)},window.onkeyup=function(t){r.handleKeyUp(t)},window.Gamepad&&navigator.getGamepads&&r.enableGamePad(),r.startRun()},window.onerror=function(t,e,i,n,r){}},{"./game":2}],16:[function(t,e,i){"use strict";var n=t("../hakurei").object.sprite,r=t("../hakurei").util,o=t("./exchange_anim"),s=function(t){n.apply(this,arguments)};r.inherit(s,n),s.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.span=0,this.exchange_animation_start_count=0,this.exchange_anim=new o(this.scene)},s.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.exchange_animation_start_count&&this.frame_count-this.exchange_animation_start_count>this.span&&(this.exchange_animation_start_count=0,this.removeSubObject(this.exchange_anim))},s.prototype.spriteName=function(){return"alterego"},s.prototype.spriteIndices=function(){return[{x:0,y:0}]},s.prototype.spriteWidth=function(){return 200},s.prototype.spriteHeight=function(){return 200},s.prototype.scaleWidth=function(){return.2},s.prototype.scaleHeight=function(){return.2},s.prototype.scaleWidth=function(){return this.exchange_animation_start_count&&this.span/2<this.frame_count-this.exchange_animation_start_count?.2*(this.span/2-(this.frame_count-this.exchange_animation_start_count-this.span/2))/(this.span/2):.2},s.prototype.scaleHeight=function(){return this.exchange_animation_start_count&&this.span/2<this.frame_count-this.exchange_animation_start_count?.2*(this.span/2-(this.frame_count-this.exchange_animation_start_count-this.span/2))/(this.span/2):.2},s.prototype.startExchange=function(t){this.exchange_animation_start_count=this.frame_count,this.span=t,this.exchange_anim.init(this.x,this.y,t),this.addSubObject(this.exchange_anim)},e.exports=s},{"../hakurei":3,"./exchange_anim":17}],17:[function(t,e,i){"use strict";var n=t("../hakurei").object.sprite,r=t("../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e,i){n.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.anim_span=i},o.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments)},o.prototype.spriteName=function(){return"exchange"},o.prototype.spriteIndices=function(){return[{x:0,y:0}]},o.prototype.spriteWidth=function(){return 200},o.prototype.spriteHeight=function(){return 200},o.prototype.scaleWidth=function(){return this.frame_count<this.anim_span/2?.25*this.frame_count/(this.anim_span/2):.25},o.prototype.scaleHeight=function(){return this.frame_count<this.anim_span/2?.25*this.frame_count/(this.anim_span/2):.25},e.exports=o},{"../hakurei":3}],18:[function(t,e,i){"use strict";var n=t("../../hakurei").object.sprite,r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.collisionWidth=function(){return 32},o.prototype.collisionHeight=function(){return 32},o.prototype.spriteName=function(){return"block"},o.prototype.spriteIndices=function(){console.error("spriteIndices must be overwritten")},o.prototype.spriteWidth=function(){return 16},o.prototype.spriteHeight=function(){return 16},o.prototype.scaleWidth=function(){return 1.5},o.prototype.scaleHeight=function(){return 1.5},e.exports=o},{"../../hakurei":3}],19:[function(t,e,i){"use strict";var n=(t("../../constant"),t("./block_base")),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteIndices=function(){return[{x:5,y:0}]},e.exports=o},{"../../constant":1,"../../hakurei":3,"./block_base":18}],20:[function(t,e,i){"use strict";var n=(t("../../constant"),t("./block_base")),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteIndices=function(){return[{x:3,y:0}]},e.exports=o},{"../../constant":1,"../../hakurei":3,"./block_base":18}],21:[function(t,e,i){"use strict";var n=(t("../../constant"),t("./block_base")),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteIndices=function(){return[{x:4,y:0}]},e.exports=o},{"../../constant":1,"../../hakurei":3,"./block_base":18}],22:[function(t,e,i){"use strict";var n=(t("../../constant"),t("./block_base")),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteIndices=function(){return[{x:7,y:0}]},e.exports=o},{"../../constant":1,"../../hakurei":3,"./block_base":18}],23:[function(t,e,i){"use strict";var n=(t("../../constant"),t("./block_base")),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteIndices=function(){return[{x:6,y:0}]},e.exports=o},{"../../constant":1,"../../hakurei":3,"./block_base":18}],24:[function(t,e,i){"use strict";var n=t("../../constant"),r=t("../../hakurei").object.base,o=t("../../hakurei").util,s=function(t){r.apply(this,arguments)};o.inherit(s,r),s.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e},s.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx,e=this.core.image_loader.getImage("item");t.drawImage(e,0,96,32,32,this.x,this.y,n.TILE_SIZE,n.TILE_SIZE)},e.exports=s},{"../../constant":1,"../../hakurei":3}],25:[function(t,e,i){"use strict";var n=(t("../../constant"),t("../../hakurei").object.sprite),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteName=function(){return"item"},o.prototype.spriteIndices=function(){return[{x:3,y:2}]},o.prototype.spriteWidth=function(){return 32},o.prototype.spriteHeight=function(){return 32},o.prototype.scaleWidth=function(){return 1},o.prototype.scaleHeight=function(){return 1},e.exports=o},{"../../constant":1,"../../hakurei":3}],26:[function(t,e,i){"use strict";var n=(t("../../constant"),t("../../hakurei").object.sprite),r=t("../../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e},o.prototype.spriteName=function(){return"hashigo"},o.prototype.spriteIndices=function(){return[{x:0,y:0}]},o.prototype.spriteWidth=function(){return 32},o.prototype.spriteHeight=function(){return 16},o.prototype.scaleWidth=function(){return.75},o.prototype.scaleHeight=function(){return 1.5},o.prototype.collisionWidth=function(){return 32},o.prototype.collisionHeight=function(){return 32},e.exports=o},{"../../constant":1,"../../hakurei":3}],27:[function(t,e,i){"use strict";var n=t("../../constant"),r=t("../../hakurei").constant,o=4,s=4,a=60,h=[n.BLOCK_GREEN,n.BLOCK_BLUE,n.BLOCK_RED,n.BLOCK_PURPLE,n.BLOCK_BROWN,n.LADDER],c=t("../../hakurei").object.sprite,u=(t("./block_base"),t("../alterego")),p=t("../exchange_anim"),l=t("../../hakurei").util,f=function(t){c.apply(this,arguments)};l.inherit(f,c),f.prototype.init=function(t,e){c.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_reflect=!1,this.is_down=!1,this.is_down_ladder=!1,this.exchange_animation_start_count=0,this.alterego=new u(this.scene),this.alterego.init(this.scene.width-this.x,this.y),this.addSubObject(this.alterego),this.exchange_anim=new p(this.scene)},f.prototype.beforeDraw=function(){c.prototype.beforeDraw.apply(this,arguments),this.checkCollisionWithBlocks()?this.is_down=!1:(this.moveY(s),this.is_down=!0),this.checkCollisionWithLadder()?this.core.isKeyDown(r.BUTTON_DOWN)?(this.moveY(s),this.is_down_ladder=!0):this.core.isKeyDown(r.BUTTON_UP)&&(this.moveY(-s),this.is_down_ladder=!0):this.is_down_ladder=!1,this.exchange_animation_start_count&&this.frame_count-this.exchange_animation_start_count>a&&(this.exchange_position(),this.exchange_animation_start_count=0,this.removeSubObject(this.exchange_anim))},f.prototype.checkCollisionWithBlocks=function(){var t=this,e=!1;return h.forEach(function(i){t.scene.objects_by_tile_type[i].forEach(function(i){t.checkCollision(i)&&(e=!0)})}),e},f.prototype.checkCollisionWithLadder=function(){var t=this,e=!1;return t.scene.objects_by_tile_type[n.LADDER].forEach(function(i){t.checkCollision(i)&&(e=!0)}),e},f.prototype.moveLeft=function(){this.isEnableMove()&&(this.is_down||(this.x-=o,this.is_reflect=!0,this.alterego.x+=o))},f.prototype.moveRight=function(){this.isEnableMove()&&(this.is_down||(this.x+=o,this.is_reflect=!1,this.alterego.x-=o))},f.prototype.moveY=function(t){this.isEnableMove()&&(this.y+=t,this.alterego.y+=t)},f.prototype.isEnableMove=function(){return this.exchange_animation_start_count?!1:!0},f.prototype.startExchange=function(){this.isEnableMove()&&(this.exchange_animation_start_count=this.frame_count,this.exchange_anim.init(this.x,this.y,a),this.addSubObject(this.exchange_anim),this.alterego.startExchange(a))},f.prototype.exchange_position=function(){var t=this.x,e=this.y,i=this.alterego.x,n=this.alterego.y;this.x=i,this.y=n,this.alterego.x=t,this.alterego.y=e},f.prototype.spriteName=function(){return"player"},f.prototype.spriteIndices=function(){return this.is_down_ladder?[{x:1,y:3}]:[{x:1,y:2}]},f.prototype.spriteWidth=function(){return 32},f.prototype.spriteHeight=function(){return 48},f.prototype.scaleWidth=function(){return this.exchange_animation_start_count&&a/2<this.frame_count-this.exchange_animation_start_count?(a/2-(this.frame_count-this.exchange_animation_start_count-a/2))/(a/2):1},f.prototype.scaleHeight=function(){return this.exchange_animation_start_count&&a/2<this.frame_count-this.exchange_animation_start_count?(a/2-(this.frame_count-this.exchange_animation_start_count-a/2))/(a/2):1},f.prototype.isReflect=function(){return this.is_reflect},f.prototype.collisionWidth=function(){return 16},f.prototype.collisionHeight=function(){return 48},e.exports=f},{"../../constant":1,"../../hakurei":3,"../alterego":16,"../exchange_anim":17,"./block_base":18}],28:[function(t,e,i){"use strict";var n=t("../hakurei").scene.base,r=t("../hakurei").util,o=function(t){n.apply(this,arguments)};r.inherit(o,n),o.prototype.init=function(){n.prototype.init.apply(this,arguments),this.core.image_loader.loadImage("title_bg","./image/title_bg.jpg"),this.core.image_loader.loadImage("block","./image/block.png"),this.core.image_loader.loadImage("player","./image/player.png"),this.core.image_loader.loadImage("alterego","./image/alterego.png"),this.core.image_loader.loadImage("exchange","./image/exchange.png"),this.core.image_loader.loadImage("hashigo","./image/hashigo.png"),this.core.image_loader.loadImage("item","./image/item.png"),this.core.image_loader.loadImage("reimu_angry","./image/reimu_angry.png"),this.core.image_loader.loadImage("reimu_laugh","./image/reimu_laugh.png"),this.core.image_loader.loadImage("reimu_laugh2","./image/reimu_laugh2.png"),this.core.image_loader.loadImage("reimu_normal","./image/reimu_normal.png"),this.core.image_loader.loadImage("reimu_yoyu","./image/reimu_yoyu.png"),this.core.image_loader.loadImage("yukari_angry","./image/yukari_angry.png"),this.core.image_loader.loadImage("yukari_angry","./image/yukari_angry.png"),this.core.image_loader.loadImage("yukari_laugh","./image/yukari_laugh.png"),this.core.image_loader.loadImage("yukari_normal","./image/yukari_normal.png")},o.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.changeScene("title")},o.prototype.draw=function(){n.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.textAlign="right",t.font="30px 'ＭＳ ゴシック'",t.fillText("Now Loading...",400,225),t.restore()},e.exports=o},{"../hakurei":3}],29:[function(t,e,i){"use strict";var n=-1,r=[[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,7,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,n,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,2,2,2,2,2,2,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,2,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0],[0,0,0,0,2,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0],[0,0,0,0,2,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,1,1,0,0],[0,0,0,0,2,2,0,3,3,3,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,1,1,1,0,0],[0,0,0,0,2,2,0,3,3,3,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,9,0,0,8,0,0,0,0,0,0,0],[0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0],[0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];e.exports=r},{}],30:[function(t,e,i){"use strict";var n=25,r=50,o=t("../hakurei").util,s=t("../constant"),a=t("../object/tile/block_green"),h=t("../object/tile/block_blue"),c=t("../object/tile/block_red"),u=t("../object/tile/block_purple"),p=t("../object/tile/block_brown"),l=t("../object/tile/ladder"),f=t("../object/tile/player"),_=t("../object/tile/enemy"),g=t("../object/tile/item"),y={};y[s.BLOCK_GREEN]=a,y[s.BLOCK_BLUE]=h,y[s.BLOCK_RED]=c,y[s.BLOCK_PURPLE]=u,y[s.BLOCK_BROWN]=p,y[s.LADDER]=l,y[s.PLAYER]=f,y[s.ENEMY]=_,y[s.ITEM]=g;var m=t("../hakurei").scene.base,o=t("../hakurei").util,d=t("./stage/talk"),b=t("./stage/play"),x=t("./map/stage1"),k=function(t){m.apply(this,arguments),this.addSubScene("talk",new d(t,this)),this.addSubScene("play",new b(t,this))};o.inherit(k,m),k.prototype.init=function(){m.prototype.init.apply(this,arguments),this.objects_by_tile_type=this.initializeObjectsByTileType(),this.parseAndCreateMap(x),this.changeSubScene("talk")},k.prototype.beforeDraw=function(){m.prototype.beforeDraw.apply(this,arguments);var t=this;t.player()},k.prototype.player=function(){return this.objects_by_tile_type[s.PLAYER][0]},k.prototype.draw=function(){var t=this.core.ctx;t.save(),t.fillStyle=o.hexToRGBString("EEEEEE"),t.fillRect(0,0,this.core.width,this.core.height),t.restore(),t.save(),t.fillStyle=o.hexToRGBString("DDDDDD"),t.fillRect(n,r,30*s.TILE_SIZE,20*s.TILE_SIZE),t.restore(),t.save(),m.prototype.draw.apply(this,arguments)},k.prototype.initializeObjectsByTileType=function(){var t={};for(var e in y)t[e]=[];return t},k.prototype.parseAndCreateMap=function(t){for(var e=x,i=0;i<t.length;i++)for(var o=e[i],a=0;a<o.length;a++){var h=o[a],c=a*s.TILE_SIZE+n+12,u=i*s.TILE_SIZE+r+12,p=y[h];if(p){var l=new p(this);l.init(c,u),this.addObject(l),this.objects_by_tile_type[h]||(this.objects_by_tile_type[h]=[]),
this.objects_by_tile_type[h].push(l)}}},e.exports=k},{"../constant":1,"../hakurei":3,"../object/tile/block_blue":19,"../object/tile/block_brown":20,"../object/tile/block_green":21,"../object/tile/block_purple":22,"../object/tile/block_red":23,"../object/tile/enemy":24,"../object/tile/item":25,"../object/tile/ladder":26,"../object/tile/player":27,"./map/stage1":29,"./stage/play":31,"./stage/talk":32}],31:[function(t,e,i){"use strict";var n=t("../../hakurei").scene.base,r=t("../../hakurei").constant,o=t("../../hakurei").util,s=function(t,e){n.apply(this,arguments)};o.inherit(s,n),s.prototype.init=function(){n.prototype.init.apply(this,arguments)},s.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.core.isKeyDown(r.BUTTON_LEFT)&&this.parent.player().moveLeft(),this.core.isKeyDown(r.BUTTON_RIGHT)&&this.parent.player().moveRight(),this.core.isKeyPush(r.BUTTON_X)&&this.parent.player().startExchange()},e.exports=s},{"../../hakurei":3}],32:[function(t,e,i){"use strict";var n=20,r=5,o=.5,s=t("../../hakurei").scene.base,a=t("../../hakurei").constant,h=t("../../hakurei").util,c=t("../../logic/serif_manager"),u=t("../../logic/serif/stage1/before"),p=function(t){s.apply(this,arguments),this.serif=new c(u)};h.inherit(p,s),p.prototype.init=function(){s.prototype.init.apply(this,arguments),this.serif.init()},p.prototype.beforeDraw=function(){s.prototype.beforeDraw.apply(this,arguments),this.core.isKeyPush(a.BUTTON_Z)&&(this.serif.is_end()?this.parent.changeSubScene("play"):this.serif.next())},p.prototype.draw=function(){s.prototype.draw.apply(this,arguments);this.core.ctx;this.serif.right_image()&&this._showRightChara(),this.serif.left_image()&&this._showLeftChara(),this._showMessageWindow(),this._showMessage()},p.prototype._showRightChara=function(){var t=this.core.ctx;t.save();var e=400,i=50;this.serif.is_right_talking()?(e-=r,i-=r):t.globalAlpha=.5;var n=this.core.image_loader.getImage(this.serif.right_image());t.drawImage(n,e,i,n.width*o,n.height*o),t.restore()},p.prototype._showLeftChara=function(){var t=this.core.ctx;t.save();var e=-100,i=100;this.serif.is_left_talking()?(e-=-r,i-=r):t.globalAlpha=.5;var n=this.core.image_loader.getImage(this.serif.left_image());t.transform(-1,0,0,1,n.width*o,0),t.drawImage(n,-e,i,n.width*o,n.height*o),t.restore()},p.prototype._showMessageWindow=function(){var t=this.core.ctx;t.save();var e=100;t.globalAlpha=.5,t.fillStyle="rgb( 0, 0, 0 )",t.fillRect(n,this.core.height-e-n,this.core.width-2*n,e),t.restore()},p.prototype._showMessage=function(){var t=this.core.ctx;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle",t.fillStyle="rgb( 255, 255, 255 )";var e,i=this.serif.lines();if(i.length){var r=100;e=this.core.height-r+n;for(var o=0,s=i.length;s>o;o++)t.fillText(i[o],2*n,e),e+=30}t.restore()},e.exports=p},{"../../hakurei":3,"../../logic/serif/stage1/before":13,"../../logic/serif_manager":14}],33:[function(t,e,i){"use strict";var n=t("../hakurei").scene.base,r=t("../hakurei").util,o=t("../hakurei").constant,s=100,a=function(t){n.apply(this,arguments)};r.inherit(a,n),a.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.core.isKeyPush(o.BUTTON_Z)&&this.core.changeScene("stage")},a.prototype.draw=function(){this.core.clearCanvas();var t=this.core.ctx;t.save(),this.frame_count<s?t.globalAlpha=this.frame_count/s:t.globalAlpha=1;var e=this.core.image_loader.getImage("title_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.core.width,this.core.height),t.fillStyle="rgb( 0, 0, 0 )",t.fillStyle="rgb( 255, 255, 255 )",t.textAlign="center",t.font="60px 'ＭＳ ゴシック'",t.fillText("タイトルロゴ(仮)",this.core.width/2,100),t.fillStyle="rgb( 255, 255, 255 )",t.font="35px 'ＭＳ ゴシック'",t.textAlign="left",t.fillText("→ Story Start",280,400),t.fillText("　 Stage Select",280,450),t.restore()},e.exports=a},{"../hakurei":3}]},{},[15]);