!function t(e,i,r){function o(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return o(i?i:t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,i){"use strict";var r={};r.images={title:"./image/title.png",title_bg:"./image/title_bg.png",stage_bg:"./image/stage_bg.png",bg:"./image/bg.png",stage_tile_24:"./image/stage_tile_24.png",stage_tile_32:"./image/stage_tile_32.png",block:"./image/block.png",hashigo:"./image/hashigo.png",reimu_angry1:"./image/reimu/angry1.png",reimu_angry2:"./image/reimu/angry2.png",reimu_confused:"./image/reimu/confused.png",reimu_cry:"./image/reimu/cry.png",reimu_laugh:"./image/reimu/laugh1.png",reimu_laugh2:"./image/reimu/laugh2.png",reimu_normal1:"./image/reimu/normal1.png",reimu_normal2:"./image/reimu/normal2.png",reimu_smile:"./image/reimu/smile.png",reimu_yarare:"./image/reimu/yarare.png",yukari_angry:"./image/yukari/angry.png",yukari_confused:"./image/yukari/confused.png",yukari_disappointed:"./image/yukari/disappointed.png",yukari_ecstasy1:"./image/yukari/ecstasy1.png",yukari_ecstasy2:"./image/yukari/ecstasy2.png",yukari_laugh:"./image/yukari/laugh.png",yukari_normal1:"./image/yukari/normal1.png",yukari_normal2:"./image/yukari/normal2.png",yukari_normal3:"./image/yukari/normal3.png",yukari_normal4:"./image/yukari/normal4.png",yukari_smile:"./image/yukari/smile.png",yukari_yarare:"./image/yukari/yarare.png"},r.sounds={forbidden:{path:"./sound/forbidden.wav",volume:.8},select:{path:"./sound/select.wav",volume:.8},boss_powerup:{path:"./sound/boss_powerup.wav",volume:.8},dead:{path:"./sound/dead.wav",volume:.5},powerup:{path:"./sound/powerup.wav",volume:.8}},r.bgms={stage_a:{path:"./bgm/stage_a.ogg",loopStart:29.143,loopEnd:111.429},title:{path:"./bgm/title.ogg",loopStart:10.312,loopEnd:51.562}},e.exports=r},{}],2:[function(t,e,i){"use strict";var r=t("./debug_constant"),o={DEBUG:{},TILE_SIZE:24,BLOCK_GREEN:1,BLOCK_BLUE:2,BLOCK_RED:3,BLOCK_PURPLE:4,BLOCK_BROWN:5,LADDER:6,PLAYER:7,ENEMY:8,ITEM:9,DEATH:10,BLOCK_STONE1:11,BLOCK_STONE2:12,BLOCK_STONE3:13,STATE_NORMAL:1,STATE_CLIMBDOWN:2,STATE_DYING:3,STATE_EXCHANGE:4,STATE_FALLDOWN:5,STATE_MOVELEFT:6,STATE_MOVERIGHT:7};o.RENDER_SORT=[o.BLOCK_GREEN,o.BLOCK_BLUE,o.BLOCK_RED,o.BLOCK_PURPLE,o.BLOCK_BROWN,o.BLOCK_STONE1,o.BLOCK_STONE2,o.BLOCK_STONE3,o.DEATH,o.LADDER,o.ENEMY,o.PLAYER,o.ITEM],r.ON&&(o.DEBUG=r),e.exports=o},{"./debug_constant":3}],3:[function(t,e,i){"use strict";var r={ON:!1,SOUND_OFF:!0};e.exports=r},{}],4:[function(t,e,i){"use strict";var r=t("./hakurei").core,o=t("./hakurei").util,n=t("./constant"),s=t("./scene/loading"),a=t("./scene/title"),h=t("./scene/stage"),c=t("./scene/prerelease_end"),u=function(t){r.apply(this,arguments)};o.inherit(u,r),u.prototype.init=function(){r.prototype.init.apply(this,arguments),this.addScene("loading",new s(this)),this.addScene("prerelease_end",new c(this)),this.addScene("title",new a(this)),this.addScene("stage",new h(this)),this.changeScene("loading")},u.prototype.playSound=function(){return n.DEBUG.SOUND_OFF?void 0:this.audio_loader.playSound.apply(this.audio_loader,arguments)},u.prototype.playBGM=function(){return n.DEBUG.SOUND_OFF?void 0:this.audio_loader.playBGM.apply(this.audio_loader,arguments)},u.prototype.stopBGM=function(){return n.DEBUG.SOUND_OFF?void 0:this.audio_loader.stopBGM.apply(this.audio_loader,arguments)},e.exports=u},{"./constant":2,"./hakurei":5,"./scene/loading":52,"./scene/prerelease_end":58,"./scene/stage":59,"./scene/title":65}],5:[function(t,e,i){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":11}],6:[function(t,e,i){"use strict";var r=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0,this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode,this.audio_source=null};r.prototype.init=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0},r.prototype.loadSound=function(t,e,i){var r=this;r.loading_audio_num++,i||(i=1);var o=function(){r.loaded_audio_num++},n=new Audio(e);n.volume=i,n.addEventListener("canplay",o),n.load(),r.sounds[t]={id:1<<r.id++,audio:n}},r.prototype.loadBGM=function(t,e,i,r,o){var n=this;n.loading_audio_num++;var s=function(e){n.loaded_audio_num++,n.bgms[t]={audio:e,volume:i,loopStart:r,loopEnd:o}},a=function(t){throw t instanceof Error?new Error(t.message):t},h=new XMLHttpRequest;h.onload=function(){if(200===h.status){var t=h.response;n.audio_context.decodeAudioData(t,s,a)}},h.open("GET",e,!0),h.responseType="arraybuffer",h.send(null)},r.prototype.isAllLoaded=function(){return this.loaded_audio_num>0&&this.loaded_audio_num===this.loading_audio_num},r.prototype.playSound=function(t){this.soundflag|=this.sounds[t].id},r.prototype.executePlaySound=function(){for(var t in this.sounds)this.soundflag&this.sounds[t].id&&(this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),this.soundflag&=~this.sounds[t].id)},r.prototype.playBGM=function(t){var e=this;e.stopBGM(),e.audio_source=e._createSourceNode(t),e.audio_source.start(0)},r.prototype.stopBGM=function(){var t=this;t.isPlayingBGM()&&(t.audio_source.stop(0),t.audio_source=null)},r.prototype.isPlayingBGM=function(){return this.audio_source?!0:!1},r.prototype._createSourceNode=function(t){var e=this,i=e.bgms[t],r=e.audio_context.createBufferSource();r.buffer=i.audio,(i.loopStart||i.loopEnd)&&(r.loop=!0),i.loopStart&&(r.loopStart=i.loopStart),i.loopEnd&&(r.loopEnd=i.loopEnd);var o=this.audio_context.createGain();return o.gain.value=i.volume||1,r.connect(o),o.connect(e.audio_context.destination),r.start=r.start||r.noteOn,r.stop=r.stop||r.noteOff,r},r.prototype.progress=function(){return this.loaded_audio_num/this.loading_audio_num},e.exports=r},{}],7:[function(t,e,i){"use strict";var r=function(){this.is_done=!1};r.prototype.init=function(){this.is_done=!1},r.prototype.isAllLoaded=function(){return this.is_done},r.prototype.notifyLoadingDone=function(){this.is_done=!0},r.prototype.progress=function(){return this.is_done?1:0},e.exports=r},{}],8:[function(t,e,i){"use strict";var r=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};r.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},r.prototype.loadImage=function(t,e){var i=this;i.loading_image_num++;var r=function(){i.loaded_image_num++},o=new Image;o.src=e,o.onload=r,this.images[t]=o},r.prototype.isAllLoaded=function(){return this.loaded_image_num>0&&this.loaded_image_num===this.loading_image_num},r.prototype.getImage=function(t){return this.images[t]},r.prototype.progress=function(){return this.loaded_image_num/this.loading_image_num},e.exports=r},{}],9:[function(t,e,i){"use strict";var r={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=r},{}],10:[function(t,e,i){"use strict";var r=t("./constant"),o=t("./asset_loader/image"),n=t("./asset_loader/audio"),s=t("./asset_loader/font"),a=function(t){this.canvas_dom=t,this.ctx=this.canvas_dom.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.current_scene=null,this._reserved_next_scene=null,this.scenes={},this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader=new o,this.audio_loader=new n,this.font_loader=new s};a.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader.init()},a.prototype.enableGamePad=function(){this.is_connect_gamepad=!0},a.prototype.isRunning=function(){return this.request_id?!0:!1},a.prototype.startRun=function(){this.isRunning()||this.run()},a.prototype.run=function(){this.handleGamePad(),this.changeNextSceneIfReserved(),this.audio_loader.executePlaySound();var t=this.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw()),this.before_keyflag=this.current_keyflag,this.frame_count++,this.request_id=requestAnimationFrame(this.run.bind(this))},a.prototype.currentScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},a.prototype.addScene=function(t,e){this.scenes[t]=e},a.prototype.changeScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},a.prototype.changeNextSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},a.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.width,this.height)},a.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},a.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},a.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},a.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},a.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=r.BUTTON_SHIFT;break;case 32:e=r.BUTTON_SPACE;break;case 37:e=r.BUTTON_LEFT;break;case 38:e=r.BUTTON_UP;break;case 39:e=r.BUTTON_RIGHT;break;case 40:e=r.BUTTON_DOWN;break;case 88:e=r.BUTTON_X;break;case 90:e=r.BUTTON_Z}return e},a.prototype.handleGamePad=function(){if(this.is_connect_gamepad){var t=navigator.getGamepads(),e=t[0];e&&(this.current_keyflag=0,this.current_keyflag|=e.buttons[1].pressed?r.BUTTON_Z:0,this.current_keyflag|=e.buttons[0].pressed?r.BUTTON_X:0,this.current_keyflag|=e.buttons[2].pressed?r.BUTTON_SELECT:0,this.current_keyflag|=e.buttons[3].pressed?r.BUTTON_START:0,this.current_keyflag|=e.buttons[4].pressed?r.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[5].pressed?r.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[6].pressed?r.BUTTON_SPACE:0,this.current_keyflag|=e.axes[1]<-.5?r.BUTTON_UP:0,this.current_keyflag|=e.axes[1]>.5?r.BUTTON_DOWN:0,this.current_keyflag|=e.axes[0]<-.5?r.BUTTON_LEFT:0,this.current_keyflag|=e.axes[0]>.5?r.BUTTON_RIGHT:0)}},a.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},a.prototype.fontLoadingDone=function(){this.font_loader.notifyLoadingDone()},e.exports=a},{"./asset_loader/audio":6,"./asset_loader/font":7,"./asset_loader/image":8,"./constant":9}],11:[function(t,e,i){"use strict";e.exports={util:t("./util"),core:t("./core"),constant:t("./constant"),serif_manager:t("./serif_manager"),scene:{base:t("./scene/base")},object:{base:t("./object/base"),sprite:t("./object/sprite"),pool_manager:t("./object/pool_manager")},asset_loader:{image:t("./asset_loader/image")}}},{"./asset_loader/image":8,"./constant":9,"./core":10,"./object/base":12,"./object/pool_manager":13,"./object/sprite":14,"./scene/base":15,"./serif_manager":16,"./util":17}],12:[function(t,e,i){"use strict";var r=t("../util"),o=0,n=!1,s=function(t,e){this.scene=t,this.core=t.core,this.parent=e,this.id=++o,this.frame_count=0,this.x=0,this.y=0,this.auto_disable_times_map={},this.velocity={magnitude:0,theta:0},this.objects=[]};s.prototype.init=function(){this.frame_count=0,this.x=0,this.y=0,this.auto_disable_times_map={};for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},s.prototype.beforeDraw=function(){this.frame_count++,this.checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.move()},s.prototype.draw=function(){var t=this.core.ctx;n&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore());for(var e=0,i=this.objects.length;i>e;e++)this.objects[e].draw()},s.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},s.prototype.addSubObject=function(t){this.objects.push(t)},s.prototype.removeSubObject=function(t){for(var e=0,i=this.objects.length;i>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},s.prototype.move=function(){var t=r.calcMoveXByVelocity(this.velocity),e=r.calcMoveYByVelocity(this.velocity);this.x+=t,this.y+=e},s.prototype.onCollision=function(){},s.prototype.width=function(){return 0},s.prototype.height=function(){return 0},s.prototype.globalCenterX=function(){return this.scene.x+this.x},s.prototype.globalCenterY=function(){return this.scene.y+this.y},s.prototype.globalLeftX=function(){return this.scene.x+this.x-this.width()/2},s.prototype.globalRightX=function(){return this.scene.x+this.x+this.width()/2},s.prototype.globalUpY=function(){return this.scene.x+this.y-this.height()/2},s.prototype.globalDownY=function(){return this.scene.x+this.y+this.height()/2},s.prototype.collisionWidth=function(){return 0},s.prototype.collisionHeight=function(){return 0},s.prototype.checkCollisionWithObject=function(t){var e=this;t.checkCollision(e)&&(t.onCollision(e),e.onCollision(t))},s.prototype.checkCollisionWithObjects=function(t){for(var e=this,i=0;i<t.length;i++){var r=t[i];e.checkCollision(r)&&(e.onCollision(r),r.onCollision(e))}},s.prototype.checkCollision=function(t){return Math.abs(this.x-t.x)<this.collisionWidth()/2+t.collisionWidth()/2&&Math.abs(this.y-t.y)<this.collisionHeight()/2+t.collisionHeight()/2?!0:!1},s.prototype.getCollisionLeftX=function(){return this.x-this.collisionWidth()/2},s.prototype.getCollisionRightX=function(){return this.x+this.collisionWidth()/2},s.prototype.getCollisionUpY=function(){return this.y-this.collisionHeight()/2},s.prototype.getCollisionDownY=function(){return this.y+this.collisionHeight()/2},s.prototype.setAutoDisableFlag=function(t,e){var i=this;i[t]=!0,i.auto_disable_times_map[t]=i.frame_count+e},s.prototype.checkAutoDisableFlags=function(){var t=this;for(var e in t.auto_disable_times_map)this.auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t.auto_disable_times_map[e])},s.prototype.setVelocity=function(t){this.velocity=t},e.exports=s},{"../util":17}],13:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t,e){r.apply(this,arguments),this.Class=e,this.objects={}};o.inherit(n,r),n.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={}},n.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},n.prototype.draw=function(){r.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},n.prototype.afterDraw=function(){r.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},n.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},n.prototype.remove=function(t){delete this.objects[t]},n.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var i=this.objects[e];t.checkCollision(i)&&(t.onCollision(i),i.onCollision(t))}},n.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var r=this.objects[e],o=t.objects[i];if(r.onCollision(o),o.onCollision(r),!this.objects[e])break}},e.exports=n},{"../util":17,"./base":12}],14:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t){r.apply(this,arguments),this.current_sprite_index=0};o.inherit(n,r),n.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0},n.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},n.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var i=o.thetaToRadian(this.velocity.theta+this.rotateAdjust());e.rotate(i);var n=this.spriteWidth(),s=this.spriteHeight();n||(n=t.width),s||(s=t.height);var a=this.width(),h=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.drawImage(t,n*this.spriteIndexX(),s*this.spriteIndexY(),n,s,-a/2,-h/2,a,h),e.restore()}r.prototype.draw.apply(this,arguments)},n.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},n.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},n.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},n.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},n.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},n.prototype.isShow=function(){return!0},n.prototype.spriteAnimationSpan=function(){return 0},n.prototype.spriteIndices=function(){return[{x:0,y:0}]},n.prototype.spriteWidth=function(){return 0},n.prototype.spriteHeight=function(){return 0},n.prototype.rotateAdjust=function(){return 0},n.prototype.scale=function(){return 0},n.prototype.scaleWidth=function(){return 1},n.prototype.scaleHeight=function(){return 1},n.prototype.isReflect=function(){return!1},e.exports=n},{"../util":17,"./base":12}],15:[function(t,e,i){"use strict";var r=function(t,e){this.core=t,this.parent=e,this.width=this.core.width,this.height=this.core.height,this.x=0,this.y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this.scenes={}};r.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.x=0,this.y=0,this.frame_count=0;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},r.prototype.beforeDraw=function(){this.frame_count++,this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw()},r.prototype.draw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},r.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},r.prototype.addObject=function(t){this.objects.push(t)},r.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},r.prototype.addSubScene=function(t,e){this.scenes[t]=e},r.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},r.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},e.exports=r},{}],16:[function(t,e,i){"use strict";var r=function(){this.timeoutID=null,this.script=null,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[]};r.prototype.init=function(t){t||console.error("set script arguments to use serif_manager class"),this.script=t,this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[],this.is_end()||this.next()},r.prototype.is_end=function(){return this.progress+1===this.script.length},r.prototype.next=function(){this.progress++;var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},r.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},r.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var i=t.split(""),r=i.length,o=0;e.line_num=0,e.printing_lines=[];var n=function(){if(!(o>=r)){var t=10,s=i[o];o++,"\n"===s?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+s),e.timeoutID=setTimeout(n,t)}};n()},r.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},r.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},r.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},r.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},r.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},r.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},r.prototype.lines=function(){return this.printing_lines},e.exports=r},{}],17:[function(t,e,i){"use strict";var r={inherit:function(t,e){var i=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=i(e.prototype),t.prototype.constructor=t},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(r.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(r.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,i=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);return"rgb("+i+", "+r+", "+o+")"}};e.exports=r},{}],18:[function(t,e,i){"use strict";var r=[{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"いたた..."},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"あらあら"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"あ、ゆかり"},{pos:"right",exp:"angry1",chara:"reimu",fukidashi:"normal",serif:"またアンタのしわざね"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"暇そうにしてたから♪"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"それよりほら、見て"},{pos:"right",exp:"angry1",chara:"reimu",fukidashi:"normal",serif:"なによ"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"御札が落ちてるわ"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"あれを全部拾うと帰れるわよ"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"どういう理屈よ"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"わたしじゃ取れない場所にあるじゃない"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"手伝ってあげるわよ"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"Xボタンで私と霊夢の位置を入れかえることができるわ"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"私は霊夢と反対の位置にいるから"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"Xボタンね"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"入れ替えられる回数には上限があるから"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"私の上にある数字をよく見ていてね"}];e.exports=r},{}],19:[function(t,e,i){"use strict";var r=[{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"..."},{pos:"right",exp:"angry1",chara:"reimu",fukidashi:"normal",serif:"帰れてないじゃない！"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"まだ先があるみたいね"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"敵みたいなのがいるから気をつけて"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"はいはい"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"わたしは敵に触れても大丈夫なのよ"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"はいはい"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"霊夢はあのオバケみたいなのに触れちゃだめよ"},{pos:"right",exp:"angry1",chara:"reimu",fukidashi:"normal",serif:"アンタだけずるくない？！"}];e.exports=r},{}],20:[function(t,e,i){"use strict";var r=[{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"なんか茶色いブロックがあるわ"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"一度乗ると消えちゃうみたいね"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"消えちゃうのね"}];e.exports=r},{}],21:[function(t,e,i){"use strict";var r=[];e.exports=r},{}],22:[function(t,e,i){"use strict";var r=[{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"アンタさっきと違う位置にいない？"},{pos:"left",exp:"normal1",chara:"yukari",fukidashi:"normal",serif:"わたしは霊夢の反対側にいるの"},{pos:"left",exp:"laugh",chara:"yukari",fukidashi:"normal",serif:"このステージでは上下の反対側にいるみたいね"},{pos:"right",exp:"normal1",chara:"reimu",fukidashi:"normal",serif:"ふぅん"}];e.exports=r},{}],23:[function(t,e,i){"use strict";var r=t("./game");window.AudioContext=window.AudioContext||window.webkitAudioContext;var o;window.onload=function(){var t=document.getElementById("mainCanvas");o=new r(t),o.init(),document.fonts?document.fonts.addEventListener("loadingdone",function(){o.fontLoadingDone()}):o.fontLoadingDone(),window.onkeydown=function(t){o.handleKeyDown(t)},window.onkeyup=function(t){o.handleKeyUp(t)},window.Gamepad&&navigator.getGamepads&&o.enableGamePad(),o.startRun()},window.onerror=function(t,e,i,r,o){},window.changeFullScreen=function(){o.fullscreen()}},{"./game":4}],24:[function(t,e,i){"use strict";var r=t("../hakurei").object.sprite,o=t("../hakurei").util,n=t("./exchange_anim"),s=function(t){r.apply(this,arguments)};o.inherit(s,r),s.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.span=0,this.exchange_animation_start_count=0,this.exchange_anim=new n(this.scene)},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.exchange_animation_start_count&&this.frame_count-this.exchange_animation_start_count>this.span&&(this.exchange_animation_start_count=0,this.removeSubObject(this.exchange_anim))},s.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save();var e=this.scene.player().remainExchangeNum();t.fillStyle="rgb( 255, 255, 255 )",t.textAlign="center",t.font="12px 'PixelMplus'",t.fillText(e,this.x,this.y-this.height()/2-10),t.restore()},s.prototype.collisionWidth=function(){return 24},s.prototype.collisionHeight=function(){return 24},s.prototype.isShow=function(){return this.exchange_animation_start_count?!1:!0},s.prototype.spriteName=function(){return"stage_tile_32"},s.prototype.spriteAnimationSpan=function(){return 30},s.prototype.spriteIndices=function(){return[{x:5,y:0},{x:6,y:0}]},s.prototype.spriteWidth=function(){return 32},s.prototype.spriteHeight=function(){return 32},s.prototype.startExchange=function(t){this.exchange_animation_start_count=this.frame_count,this.span=t;var e=!0;this.exchange_anim.init(this.x,this.y,t,e),this.addSubObject(this.exchange_anim)},e.exports=s},{"../hakurei":5,"./exchange_anim":26}],25:[function(t,e,i){"use strict";var r=t("../hakurei").object.sprite,o=t("../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e},n.prototype.spriteName=function(){return"stage_tile_24"},n.prototype.spriteIndices=function(){return[{x:0,y:1}]},n.prototype.spriteWidth=function(){return 24},n.prototype.spriteHeight=function(){return 24},e.exports=n},{"../hakurei":5}],26:[function(t,e,i){"use strict";var r=t("../hakurei").object.sprite,o=t("../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e,i,o){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_yukari=o?!0:!1,this.anim_span=i},n.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},n.prototype.spriteName=function(){return"stage_tile_32"},n.prototype.spriteIndices=function(){var t=this.is_yukari?1:3;return[{x:0,y:t},{x:1,y:t},{x:2,y:t},{x:3,y:t},{x:3,y:t},{x:4,y:t},{x:5,y:t}]},n.prototype.spriteWidth=function(){return 32},n.prototype.spriteHeight=function(){return 32},n.prototype.spriteAnimationSpan=function(){return 5},e.exports=n},{"../hakurei":5}],27:[function(t,e,i){"use strict";var r=t("../hakurei").object.sprite,o=t("../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e,i){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_vertical=i},n.prototype.draw=function(t,e,i){this.init(t,e,i),r.prototype.draw.apply(this,arguments)},n.prototype.spriteName=function(){return"stage_tile_24"},n.prototype.spriteIndices=function(){return[{x:0,y:0}]},n.prototype.spriteWidth=function(){return 24},n.prototype.spriteHeight=function(){return 24},n.prototype.rotateAdjust=function(){return this.is_vertical?90:0},e.exports=n},{"../hakurei":5}],28:[function(t,e,i){"use strict";var r=t("../hakurei").object.sprite,o=t("../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e,i){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.rotate=i||0},n.prototype.draw=function(t,e,i){this.init(t,e,i),r.prototype.draw.apply(this,arguments)},n.prototype.spriteName=function(){return"stage_tile_24"},n.prototype.spriteIndices=function(){return[{x:1,y:0}]},n.prototype.spriteWidth=function(){return 24},n.prototype.spriteHeight=function(){return 24},n.prototype.rotateAdjust=function(){return this.rotate},e.exports=n},{"../hakurei":5}],29:[function(t,e,i){"use strict";var r=t("../../hakurei").object.sprite,o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_collision=!0},n.prototype.isCollision=function(){return this.is_collision},n.prototype.collisionWidth=function(){return 24},n.prototype.collisionHeight=function(){return 24},n.prototype.spriteName=function(){return"block"},n.prototype.spriteIndices=function(){console.error("spriteIndices must be overwritten")},n.prototype.spriteWidth=function(){return 16},n.prototype.spriteHeight=function(){return 16},n.prototype.scaleWidth=function(){return 1.5},n.prototype.scaleHeight=function(){return 1.5},e.exports=n},{"../../hakurei":5}],30:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:5,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],31:[function(t,e,i){"use strict";var r=20,o=(t("../../constant"),t("./block_base")),n=t("../../hakurei").util,s=function(t){o.apply(this,arguments)};n.inherit(s,o),s.prototype.init=function(t,e){o.prototype.init.apply(this,arguments),this.start_fall_frame=0,this.is_show=!0,this.is_collision=!0},s.prototype.spriteIndices=function(){return[{x:3,y:0}]},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.start_fall_frame&&r-this.frame_count+this.start_fall_frame<=0&&(this.is_show=!1,this.start_fall_frame=0)},s.prototype.fall=function(){this.start_fall_frame=this.frame_count,this.is_collision=!1},s.prototype.isShow=function(){return this.is_show},s.prototype.isCollision=function(){return this.is_collision},s.prototype.scaleWidth=function(){var t=o.prototype.scaleWidth.apply(this,arguments);return this.start_fall_frame?t*(r-(this.frame_count-this.start_fall_frame))/r:t},s.prototype.scaleHeight=function(){var t=o.prototype.scaleHeight.apply(this,arguments);return this.start_fall_frame?t*(r-(this.frame_count-this.start_fall_frame))/r:t;
},e.exports=s},{"../../constant":2,"../../hakurei":5,"./block_base":29}],32:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:4,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],33:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:7,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],34:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:6,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],35:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:0,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],36:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:1,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],37:[function(t,e,i){"use strict";var r=(t("../../constant"),t("./block_base")),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.spriteIndices=function(){return[{x:2,y:0}]},e.exports=n},{"../../constant":2,"../../hakurei":5,"./block_base":29}],38:[function(t,e,i){"use strict";var r=(t("../../constant"),t("../../hakurei").object.sprite),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_show=!0},n.prototype.isCollision=function(){return!0},n.prototype.spriteName=function(){return"stage_tile_24"},n.prototype.spriteIndices=function(){return[{x:2,y:0}]},n.prototype.spriteWidth=function(){return 24},n.prototype.spriteHeight=function(){return 24},e.exports=n},{"../../constant":2,"../../hakurei":5}],39:[function(t,e,i){"use strict";var r=2,o=t("../../constant"),n=t("../../hakurei").object.sprite,s=t("../../hakurei").util,a=function(t){n.apply(this,arguments)};s.inherit(a,n),a.prototype.init=function(t,e){n.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_left=!1},a.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments);var t=this.x;this.is_left?this.x-=r:this.x+=r,this.checkCollisionWithBlocks()||(this.x=t,this.is_left=!this.is_left)},a.prototype.isCollision=function(){return!0};var h=[o.BLOCK_GREEN,o.BLOCK_BLUE,o.BLOCK_RED,o.BLOCK_PURPLE,o.BLOCK_BROWN,o.BLOCK_STONE1,o.BLOCK_STONE2,o.BLOCK_STONE3,o.LADDER];a.prototype.checkCollisionWithBlocks=function(){for(var t=this,e=!1,i=0;i<h.length;i++)for(var r=h[i],o=t.scene.objects_by_tile_type[r],n=0;n<o.length;n++){var s=o[n];if(!(t.y-t.collisionHeight()/2>s.y-s.collisionHeight()/2)&&s.isCollision()&&t.checkCollision(s)){e=!0;break}}return e},a.prototype.collisionWidth=function(){return 24},a.prototype.collisionHeight=function(){return 25},a.prototype.isReflect=function(){return!this.is_left},a.prototype.spriteName=function(){return"stage_tile_32"},a.prototype.spriteIndices=function(){return[{x:0,y:4},{x:1,y:4}]},a.prototype.spriteAnimationSpan=function(){return 10},a.prototype.spriteWidth=function(){return 32},a.prototype.spriteHeight=function(){return 32},a.prototype.scaleWidth=function(){return 1},a.prototype.scaleHeight=function(){return 1},e.exports=a},{"../../constant":2,"../../hakurei":5}],40:[function(t,e,i){"use strict";var r=(t("../../constant"),t("../../hakurei").object.sprite),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.is_show=!0,this.is_collision=!0,this.start_got_animation_frame_count=0},n.prototype.got=function(){this.is_collision=!1,this.core.playSound("powerup"),this.start_got_animation_frame_count=this.frame_count},n.prototype.isShow=function(){return this.is_show},n.prototype.isCollision=function(){return this.is_collision},n.prototype.beforeDraw=function(){if(r.prototype.beforeDraw.apply(this,arguments),this.start_got_animation_frame_count){var t=this.frame_count-this.start_got_animation_frame_count;10>t&&t>=0?this.y-=5:15>t&&t>=10||(this.is_show=!1,this.start_got_animation_frame_count=0)}},n.prototype.spriteName=function(){return"stage_tile_24"},n.prototype.spriteIndices=function(){return[{x:1,y:2}]},n.prototype.spriteWidth=function(){return 24},n.prototype.spriteHeight=function(){return 24},e.exports=n},{"../../constant":2,"../../hakurei":5}],41:[function(t,e,i){"use strict";var r=(t("../../constant"),t("../../hakurei").object.sprite),o=t("../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e},n.prototype.isCollision=function(){return!0},n.prototype.spriteName=function(){return"hashigo"},n.prototype.spriteIndices=function(){return[{x:0,y:0}]},n.prototype.spriteWidth=function(){return 32},n.prototype.spriteHeight=function(){return 16},n.prototype.scaleWidth=function(){return.75},n.prototype.scaleHeight=function(){return 1.5},n.prototype.collisionWidth=function(){return 24},n.prototype.collisionHeight=function(){return 24},e.exports=n},{"../../constant":2,"../../hakurei":5}],42:[function(t,e,i){"use strict";var r=t("../../constant"),o=t("../../hakurei").constant,n=2,s=3,a=2,h=34.5,c=90,u=[r.BLOCK_GREEN,r.BLOCK_BLUE,r.BLOCK_RED,r.BLOCK_PURPLE,r.BLOCK_BROWN,r.BLOCK_STONE1,r.BLOCK_STONE2,r.BLOCK_STONE3,r.LADDER],p=[r.BLOCK_GREEN,r.BLOCK_BLUE,r.BLOCK_RED,r.BLOCK_PURPLE,r.BLOCK_BROWN,r.BLOCK_STONE1,r.BLOCK_STONE2,r.BLOCK_STONE3],l=t("../../hakurei").object.sprite,f=(t("./block_base"),t("../alterego")),_=t("../exchange_anim"),y=t("../../hakurei").util,g=t("./player/state_normal"),d=t("./player/state_moveleft"),m=t("./player/state_moveright"),b=t("./player/state_climbdown"),x=t("./player/state_dying"),v=t("./player/state_exchange"),k=t("./player/state_falldown"),w=function(t){l.apply(this,arguments),this.state=null,this.states={},this.states[r.STATE_NORMAL]=new g(t,this),this.states[r.STATE_MOVELEFT]=new d(t,this),this.states[r.STATE_MOVERIGHT]=new m(t,this),this.states[r.STATE_CLIMBDOWN]=new b(t,this),this.states[r.STATE_DYING]=new x(t,this),this.states[r.STATE_EXCHANGE]=new v(t,this),this.states[r.STATE_FALLDOWN]=new k(t,this)};y.inherit(w,l),w.prototype.init=function(t,e){l.prototype.init.apply(this,arguments),this.x=t,this.y=e,this.exchange_num=0,this.scene.width/2<this.x?this.is_reflect=!0:this.is_reflect=!1,this.fall_blocks={},this.alterego=new f(this.scene),this.scene.isVertical()?this.alterego.init(this.x,this.scene.height-this.y):this.alterego.init(this.scene.width-this.x,this.y),this.addSubObject(this.alterego),this.exchange_anim=new _(this.scene),this.changeState(r.STATE_NORMAL)},w.prototype.beforeDraw=function(){l.prototype.beforeDraw.apply(this,arguments),this.currentState().beforeDraw()},w.prototype.update=function(){this.currentState()instanceof d?this.moveLeft():this.currentState()instanceof m&&this.moveRight(),this.currentState().isFallDown()&&(this.checkCollisionWithBlocks()?this.changeState(r.STATE_NORMAL):this.changeState(r.STATE_FALLDOWN));var t=this.checkCollisionWithLadder();if(t&&this.currentState().isEnableToPlayMove()&&(this.isClimbDown()&&this.checkCollisionWithBlocks2()||(this.core.isKeyDown(o.BUTTON_DOWN)?(this.changeState(r.STATE_CLIMBDOWN),this.x=t.x,this.climbDown()):this.core.isKeyDown(o.BUTTON_UP)&&(this.changeState(r.STATE_CLIMBDOWN),this.x=t.x,this.climbUp()))),!t&&this.isClimbDown()&&this.changeState(r.STATE_NORMAL),this.currentState().isEnableToDie()){var e=this.checkCollisionWithDeathOrEnemy();e&&this.startDie()}this.isDying()&&this.currentState().frame_count>c&&(this.scene.notifyPlayerDie(),this.quitDie()),this.isExchanging()&&this.currentState().frame_count>h&&(this.exchangePosition(),this.quitExchange(),this.removeSubObject(this.exchange_anim)),this.isFallingDown()&&this.fallDown();var i=this.checkCollisionWithLeftRightBlocks();i&&(i=i>0?n:-n,this.x+=i,this.scene.isVertical()?this.alterego.x+=i:this.alterego.x-=i);var s=this.checkCollisionWithItems();s&&(s.got(),this.scene.addReimuItemNum(),this.scene.isClear()&&this.scene.notifyStageClear());for(var a in this.fall_blocks){var u=this.fall_blocks[a];this.checkCollision(u)||(u.fall(),delete this.fall_blocks[u.id])}var p=this.checkCollisionWithFallBlock();p&&(this.fall_blocks[p.id]=p);var l=this.checkCollisionWithBlocks3();if(this.isNormal()&&l){var f=this.y;this.y=l.getCollisionUpY()-this.collisionHeight()/2+1,this.scene.isVertical()?this.alterego.y+=f-this.y:this.alterego.y=this.y}},w.prototype.checkCollisionWithBlocks=function(){for(var t=this,e=!1,i=0;i<u.length;i++)for(var r=u[i],o=t.scene.objects_by_tile_type[r],n=0;n<o.length;n++){var s=o[n];if(!(t.y-t.collisionHeight()/2>s.y-s.collisionHeight()/2)&&s.isCollision()&&t.checkCollision(s)){e=s;break}}return e},w.prototype.checkCollisionWithBlocks2=function(){for(var t=this,e=!1,i=0;i<p.length;i++)for(var r=p[i],o=t.scene.objects_by_tile_type[r],n=0;n<o.length;n++){var s=o[n];if(s.isCollision()&&t.checkCollision(s)){e=!0;break}}return e},w.prototype.checkCollisionWithBlocks3=function(){for(var t=this,e=!1,i=0;i<p.length;i++)for(var r=p[i],o=t.scene.objects_by_tile_type[r],n=0;n<o.length;n++){var s=o[n];if(!(t.y-t.collisionHeight()/2>s.y-s.collisionHeight()/2)&&s.isCollision()&&t.checkCollision(s)){e=s;break}}return e},w.prototype.checkCollisionWithLeftRightBlocks=function(){for(var t=this,e=0,i=0;i<p.length;i++)for(var r=p[i],o=t.scene.objects_by_tile_type[r],n=0;n<o.length;n++){var s=o[n];if(!(t.getCollisionUpY()>s.getCollisionUpY())&&!(t.getCollisionDownY()<s.getCollisionDownY())&&s.isCollision()&&t.checkCollision(s)){e=t.x-s.x;break}}return e},w.prototype.checkCollisionWithLadder=function(){var t=this,e=!1;return t.scene.objects_by_tile_type[r.LADDER].forEach(function(i){t.checkCollision(i)&&(e=i)}),e},w.prototype.checkCollisionWithItems=function(){var t=this,e=!1;return t.scene.objects_by_tile_type[r.ITEM].forEach(function(i){i.isCollision()&&t.checkCollision(i)&&(e=i)}),e},w.prototype.checkCollisionWithDeathOrEnemy=function(){var t=this,e=!1;return t.scene.objects_by_tile_type[r.DEATH].concat(t.scene.objects_by_tile_type[r.ENEMY]).forEach(function(i){t.checkCollision(i)&&(e=i)}),e},w.prototype.checkCollisionWithFallBlock=function(){for(var t=this,e=null,i=t.scene.objects_by_tile_type[r.BLOCK_BROWN],o=0;o<i.length;o++){var n=i[o];if(!(t.y-t.collisionHeight()/2>n.y-n.collisionHeight()/2)&&n.isCollision()&&t.checkCollision(n)){e=n;break}}return e},w.prototype.changeState=function(t){this.state=t,this.currentState().init(),r.DEBUG.ON&&console.log(this.state)},w.prototype.currentState=function(){return this.states[this.state]},w.prototype.moveLeft=function(){this.x-=n,this.is_reflect=!0,this.scene.isVertical()?this.alterego.x-=n:this.alterego.x+=n},w.prototype.moveRight=function(){this.x+=n,this.is_reflect=!1,this.scene.isVertical()?this.alterego.x+=n:this.alterego.x-=n},w.prototype.climbUp=function(){this.currentState().isEnableToPlayMove()&&(this.y-=a,this.scene.isVertical()?this.alterego.y+=a:this.alterego.y-=a)},w.prototype.climbDown=function(){this.currentState().isEnableToPlayMove()&&(this.y+=a,this.scene.isVertical()?this.alterego.y-=a:this.alterego.y+=a)},w.prototype.notifyMoveRight=function(){this.currentState().isEnableToPlayMove()&&this.changeState(r.STATE_MOVERIGHT)},w.prototype.notifyMoveLeft=function(){this.currentState().isEnableToPlayMove()&&this.changeState(r.STATE_MOVELEFT)},w.prototype.notifyMoveUp=function(){this.currentState().isEnableToPlayMove()&&this.changeState(r.STATE_MOVEUP)},w.prototype.notifyMoveDown=function(){this.currentState().isEnableToPlayMove()&&this.changeState(r.STATE_MOVEDOWN)},w.prototype.notifyNotMove=function(){this.currentState().isEnableToPlayMove()&&this.changeState(r.STATE_NORMAL)},w.prototype.isClimbDown=function(){return this.currentState()instanceof b},w.prototype.fallDown=function(){this.y+=s,this.scene.isVertical()?this.alterego.y-=s:this.alterego.y+=s},w.prototype.isFallingDown=function(){return this.currentState()instanceof k},w.prototype.startExchange=function(){return this.currentState().isEnableToPlayExchange()?this.checkCollisionBetweenAlterEgoAndBlocks()?!1:this.remainExchangeNum()<=0?!1:(this.changeState(r.STATE_EXCHANGE),this.exchange_anim.init(this.x,this.y,h),this.addSubObject(this.exchange_anim),this.alterego.startExchange(h),this.exchange_num++,!0):!1},w.prototype.isExchanging=function(){return this.currentState()instanceof v},w.prototype.quitExchange=function(){this.changeState(r.STATE_NORMAL)},w.prototype.isNormal=function(){return this.currentState()instanceof g},w.prototype.checkCollisionBetweenAlterEgoAndBlocks=function(){for(var t=!1,e=0;e<p.length;e++)for(var i=p[e],r=this.scene.objects_by_tile_type[i],o=0;o<r.length;o++){var n=r[o];if(this.alterego.checkCollision(n)){t=!0;break}}return t},w.prototype.exchangePosition=function(){var t=this.x,e=this.y,i=this.alterego.x,r=this.alterego.y;this.x=i,this.y=r,this.alterego.x=t,this.alterego.y=e},w.prototype.startDie=function(){this.core.playSound("dead"),this.changeState(r.STATE_DYING)},w.prototype.isDying=function(){return this.currentState()instanceof x},w.prototype.quitDie=function(){this.changeState(r.STATE_NORMAL)},w.prototype.remainExchangeNum=function(){return this.scene.max_exchange_num-this.exchange_num},w.prototype.spriteName=function(){return"stage_tile_32"},w.prototype.spriteIndices=function(){return this.isClimbDown()?[{x:5,y:2},{x:6,y:2}]:this.is_reflect?[{x:3,y:2},{x:4,y:2}]:[{x:1,y:2},{x:2,y:2}]},w.prototype.spriteAnimationSpan=function(){return 10},w.prototype.spriteWidth=function(){return 32},w.prototype.spriteHeight=function(){return 32},w.prototype.isShow=function(){return this.isDying()?this.frame_count%40>20:this.isExchanging()?!1:!0},w.prototype.collisionWidth=function(){return 24},w.prototype.collisionHeight=function(){return 32},e.exports=w},{"../../constant":2,"../../hakurei":5,"../alterego":24,"../exchange_anim":26,"./block_base":29,"./player/state_climbdown":44,"./player/state_dying":45,"./player/state_exchange":46,"./player/state_falldown":47,"./player/state_moveleft":49,"./player/state_moveright":50,"./player/state_normal":51}],43:[function(t,e,i){"use strict";var r=t("../../../hakurei").object.base,o=t("../../../hakurei").util,n=function(t,e){r.apply(this,arguments)};o.inherit(n,r),n.prototype.isEnableToPlayMove=function(){return!0},n.prototype.isEnableToPlayExchange=function(){return!0},n.prototype.isFallDown=function(){return!0},n.prototype.isEnableToDie=function(){return!0},e.exports=n},{"../../../hakurei":5}],44:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.isFallDown=function(){return!1},e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_base":43}],45:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.isEnableToPlayMove=function(){return!1},n.prototype.isEnableToPlayExchange=function(){return!1},n.prototype.isFallDown=function(){return!1},n.prototype.isEnableToDie=function(){return!1},e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_base":43}],46:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.isEnableToPlayMove=function(){return!1},n.prototype.isEnableToPlayExchange=function(){return!1},n.prototype.isFallDown=function(){return!1},n.prototype.isEnableToDie=function(){return!1},e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_base":43}],47:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.prototype.isEnableToPlayMove=function(){return!1},e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_base":43}],48:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_base":43}],49:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_move_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_move_base":48}],50:[function(t,e,i){arguments[4][49][0].apply(i,arguments)},{"../../../constant":2,"../../../hakurei":5,"./state_move_base":48,dup:49}],51:[function(t,e,i){"use strict";var r=(t("../../../constant"),t("./state_base")),o=t("../../../hakurei").util,n=function(t){r.apply(this,arguments)};o.inherit(n,r),e.exports=n},{"../../../constant":2,"../../../hakurei":5,"./state_base":43}],52:[function(t,e,i){"use strict";var r=t("../hakurei").scene.base,o=t("../hakurei").util,n=t("../assets_config"),s=function(t){r.apply(this,arguments)};o.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments);for(var t in n.images)this.core.image_loader.loadImage(t,n.images[t]);for(var e in n.sounds){var i=n.sounds[e];this.core.audio_loader.loadSound(e,i.path,i.volume)}for(var o in n.bgms){var s=n.bgms[o];this.core.audio_loader.loadBGM(o,s.path,1,s.loopStart,s.loopEnd)}},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.audio_loader.isAllLoaded()&&this.core.font_loader.isAllLoaded()&&this.core.changeScene("title")},s.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle="white",t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e=this.frame_count%60,i=15,o="";o=i>e&&e>=0?"":2*i>e&&e>=1*i?".":3*i>e&&e>=2*i?"..":"...",t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.textAlign="left",t.font="30px 'Migu'",t.fillText("Now Loading"+o,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle="rgb(119, 66, 244)",t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()},s.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},e.exports=s},{"../assets_config":1,"../hakurei":5}],53:[function(t,e,i){"use strict";var r=-1,o=10,n=11,s=12,a=13,h=[[0,0,0,0,0,0,0,0,0,0,0,n,s,s,s,s,s,s,a,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,n,s,s,s,s,a,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,n,s,s,a,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,n,s,s,a,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,n,s,s,a,0,0,0,0,0,0,7,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,n,s,s,a,0,0,0,0,0,0,r,0,0,0,0,0,0],[0,n,s,s,s,s,s,a,6,n,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,a,0],[0,0,0,0,n,a,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n,s,a,0,0],[0,0,0,0,n,a,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n,s,a,0,0],[0,0,0,0,n,a,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,n,s,a,0,0],[0,0,0,0,n,a,0,n,s,a,0,0,0,0,0,0,0,0,0,0,n,s,a,0,0,n,s,a,0,0],[0,0,0,0,n,a,0,n,s,a,0,0,0,0,0,0,0,0,0,0,n,s,a,0,0,n,s,a,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0],[0,n,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,a,0],[0,0,n,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,a,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o]];e.exports={map:h,exchange_num:2,is_vertical:!1}},{}],54:[function(t,e,i){"use strict";var r=10,o=11,n=12,s=13,a=9,h=8,c=7,u=6,p=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,a,0,0,0,0,0,0,0,0,c,0,0,0,0,0,0,0,0,0,a,0,0,0,0,0],[0,0,0,0,0,o,s,u,o,s,0,0,0,0,0,0,0,0,0,0,o,n,n,n,s,0,0,0,0,0],[0,0,0,0,0,0,0,u,0,0,0,0,o,n,n,n,n,s,0,0,0,0,u,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u,0,0,0,0,0,0,0],[0,0,0,a,a,0,h,0,0,0,h,0,0,0,a,a,0,0,0,0,0,0,u,0,0,a,a,0,0,0],[0,o,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,s,0],[0,0,o,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,s,0,0],[0,0,0,o,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,s,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]];e.exports={map:p,exchange_num:3,is_vertical:!1}},{}],55:[function(t,e,i){"use strict";var r=10,o=11,n=12,s=13,a=8,h=6,c=7,u=9,p=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,u,0,u,0,u,0,u,0,0,0,0,0,0,0,0,0,a,0,0],[0,o,s,h,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,o,n,s,0],[0,0,0,h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,h,0,0,0,0,0,c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,o,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,h,n,n,s,0,0],[0,0,0,o,n,n,n,n,n,s,0,0,0,0,0,0,0,0,0,0,0,0,o,n,h,n,s,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h,0,0,0,0,0],[0,0,a,0,0,0,0,0,0,0,0,u,0,u,0,u,0,u,0,0,0,0,0,0,h,0,0,0,0,0],[0,o,n,s,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,o,n,s,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]];e.exports={map:p,exchange_num:1,is_vertical:!1}},{}],56:[function(t,e,i){"use strict";var r=10,o=11,n=12,s=13,a=9,h=8,c=7,u=6,p=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a,0,0,a,0,0,0],[0,0,o,s,u,o,n,n,s,0,0,0,0,0,0,0,0,0,0,0,0,0,o,n,n,n,n,s,0,0],[0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,0,a,0,h,0,0,0,0,0,0,0,0,0,0,a,0,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,o,n,n,n,n,n,n,n,n,n,n,n,n,n,n,s,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,0,o,n,n,n,n,s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a,0,0,0,0,0,0,a,0,0,0],[0,0,0,0,u,0,0,0,0,0,0,0,0,0,0,0,0,0,o,n,n,n,n,n,n,n,n,s,0,0],[0,0,0,h,u,0,0,0,a,0,0,0,0,0,a,0,0,0,0,0,0,0,0,o,n,n,s,0,0,0],[0,0,0,o,n,n,n,n,n,n,n,n,n,n,n,n,n,s,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]];e.exports={map:p,exchange_num:2,is_vertical:!1}},{}],57:[function(t,e,i){"use strict";var r=-1,o=10,n=11,s=12,a=13,h=9,c=8,u=7,p=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,h,h,h,0,0,c,c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h,h,h,0,0,0],[0,n,s,s,s,s,s,s,s,s,5,5,5,5,5,5,5,5,5,5,s,s,s,s,s,s,s,s,a,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,h,h,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,u,0,0,0,0,0,0,0,0,0,0,0,n,s,s,a,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,r,0,h,h,h,0,0,0,0,0,0,0,0,s,s,0,0,0,0,0,0,0,0,h,h,h,0,0,0],[0,n,s,s,s,s,s,s,s,s,5,5,s,s,s,s,s,s,5,5,s,s,s,s,s,s,s,s,a,0],[0,0,n,s,s,s,s,s,s,s,0,0,s,s,s,s,s,s,0,0,s,s,s,s,s,s,s,a,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o]];e.exports={map:p,exchange_num:4,is_vertical:!0}},{}],58:[function(t,e,i){"use strict";var r=t("../hakurei").scene.base,o=t("../hakurei").util,n=t("../hakurei").constant,s=function(t){r.apply(this,arguments)};o.inherit(s,r),s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.isKeyPush(n.BUTTON_Z)&&(this.core.playSound("select"),this.core.changeScene("title"))},s.prototype.draw=function(){this.core.clearCanvas();var t=this.core.ctx;t.save(),t.fillStyle=o.hexToRGBString("000000"),t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e="体験版 終了";t.textAlign="center",t.fillStyle="rgb( 255, 255, 255 )",t.font="60px 'Migu'",t.fillText(e,this.core.width/2,100);for(var i=["ここまでプレイくださり","ありがとうございました。","","完成版は2017年夏コミで頒布予定です。","恐らく以下が豪華になります。","","1. ステージ数が 5 -> 40に増えます。","2. ゆかれいむ成分が増えます。","3. その他もろもろ増えます。","","完成版もよろしくお願いします..！"],r=0;r<i.length;r++)t.font="24px 'Migu'",t.textAlign="left",t.fillStyle="rgb( 255, 255, 255 )",t.fillText(i[r],100,180+30*r);t.font="38px 'Migu'",t.textAlign="center",this.frame_count%80>40&&(e="Press Z to Return",t.fillStyle="rgb( 0, 0, 0 )",t.lineWidth=4,t.strokeText(e,this.core.width/2,550),t.fillStyle="rgb( 255, 255, 255 )",t.fillText(e,this.core.width/2,550)),t.restore()},e.exports=s},{"../hakurei":5}],59:[function(t,e,i){"use strict";var r=25,o=50,n=t("../hakurei").util,s=t("../constant"),a=t("../object/background_eye"),h=t("../object/stage_frame1"),c=t("../object/stage_frame2"),u=t("../object/tile/block_green"),p=t("../object/tile/block_blue"),l=t("../object/tile/block_red"),f=t("../object/tile/block_purple"),_=t("../object/tile/block_brown"),y=t("../object/tile/ladder"),g=t("../object/tile/player"),d=t("../object/tile/enemy"),m=t("../object/tile/item"),b=t("../object/tile/death"),x=t("../object/tile/block_stone1"),v=t("../object/tile/block_stone2"),k=t("../object/tile/block_stone3"),w={};w[s.BLOCK_GREEN]=u,w[s.BLOCK_BLUE]=p,w[s.BLOCK_RED]=l,w[s.BLOCK_PURPLE]=f,w[s.BLOCK_BROWN]=_,w[s.LADDER]=y,w[s.PLAYER]=g,w[s.ENEMY]=d,w[s.ITEM]=m,w[s.DEATH]=b,w[s.BLOCK_STONE1]=x,w[s.BLOCK_STONE2]=v,w[s.BLOCK_STONE3]=k;var S=t("../hakurei").scene.base,n=t("../hakurei").util,T=t("./stage/talk"),E=t("./stage/play"),O=t("./stage/result_clear"),C=t("./stage/result_gameover"),D=[null,t("./map/stage1"),t("./map/stage2"),t("./map/stage3"),t("./map/stage4"),t("./map/stage5")],B=[null,t("../logic/serif/stage1/before"),t("../logic/serif/stage2/before"),t("../logic/serif/stage3/before"),t("../logic/serif/stage4/before"),t("../logic/serif/stage5/before")],N=[null,0,1,3,4,6],L=function(t){S.apply(this,arguments),this.addSubScene("talk",new T(t,this)),this.addSubScene("play",new E(t,this)),this.addSubScene("result_clear",new O(t,this)),this.addSubScene("result_gameover",new C(t,this))};n.inherit(L,S),L.prototype.init=function(t,e,i){S.prototype.init.apply(this,arguments),this.stage_no=t||1,e||(e="talk"),this.is_play_bgm=i?!0:!1,this.is_play_bgm&&this.core.stopBGM(),this.reimu_item_num=0,this.eyes=[],this.max_exchange_num=D[this.stage_no].exchange_num,this._is_vertical=D[this.stage_no].is_vertical,this.objects_by_tile_type=this.initializeObjectsByTileType(),this.createBackGroundEyes(),s.DEBUG.ON&&this.checkValidMap(D[this.stage_no].map),this.parseAndCreateMap(D[this.stage_no].map),this.max_item_num=this.calcItemNum(),"talk"===e?this.changeSubScene("talk",B[this.stage_no]):this.changeSubScene(e)},L.prototype.beforeDraw=function(){S.prototype.beforeDraw.apply(this,arguments),this.is_play_bgm&&60===this.frame_count&&this.core.playBGM("stage_a")},L.prototype.notifyPlayerDie=function(){this.changeSubScene("result_gameover")},L.prototype.notifyStageClear=function(){this.changeSubScene("result_clear")},L.prototype.notifyClearEnd=function(){this.hasNextStage()?this.core.changeScene("stage",this.stage_no+1):this.core.changeScene("prerelease_end")},L.prototype.notifyGameOverEnd=function(){this.core.changeScene("stage",this.stage_no,"play")},L.prototype.hasNextStage=function(){return D[this.stage_no+1]?!0:!1},L.prototype.player=function(){return this.objects_by_tile_type[s.PLAYER][0]},L.prototype.isClear=function(){return this.reimu_item_num>=this.max_item_num?!0:!1},L.prototype.isVertical=function(){return this._is_vertical},L.prototype.draw=function(){var t=this.core.ctx;t.save();var e=this.core.image_loader.getImage("stage_bg"),i=t.createPattern(e,"repeat");t.fillStyle=i,t.translate(-this.frame_count%103,-103+this.frame_count%103),t.fillRect(0,0,1648,1648),t.restore(),t.save();var n=this.core.image_loader.getImage("bg"),a=t.createPattern(n,"repeat");t.fillStyle=a,t.fillRect(r,o,30*s.TILE_SIZE,20*s.TILE_SIZE),t.restore(),t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.textAlign="right",t.font="24px 'PixelMplus'",t.fillText("ステージ: "+this.stage_no,this.core.width-30,30),t.restore(),t.save();for(var h=0,c=this.eyes.length;c>h;h++)this.eyes[h].draw();for(var u=0;u<s.RENDER_SORT.length;u++)for(var p=s.RENDER_SORT[u],l=0,f=this.objects_by_tile_type[p].length;f>l;l++)this.objects_by_tile_type[p][l].draw();this.drawFrames(),this.currentSubScene()&&this.currentSubScene().draw()},L.prototype.initializeObjectsByTileType=function(){var t={};for(var e in w)t[e]=[];return t},L.prototype.addReimuItemNum=function(){this.reimu_item_num+=1},L.prototype.checkValidMap=function(t){20!==t.length&&window.alert("マップの縦が20行である必要があります。");for(var e=!1,i=0;i<t.length;i++)for(var r=t[i],o=0;o<r.length;o++){var n=r[o];n===s.PLAYER&&(e=!0)}e||window.alert("このマップではプレイヤーの位置が定義されていません。")},L.prototype.parseAndCreateMap=function(t){for(var e=t,i=0;i<t.length;i++)for(var n=e[i],a=0;a<n.length;a++){var h=n[a],c=a*s.TILE_SIZE+r+12,u=i*s.TILE_SIZE+o+12,p=w[h];if(p){var l=new p(this);l.init(c,u),this.addObject(l),this.objects_by_tile_type[h]||(this.objects_by_tile_type[h]=[]),this.objects_by_tile_type[h].push(l)}}},L.prototype.drawFrames=function(){for(var t,e,i,n=new h(this),a=new c(this),u=0;19>u;u++)t=r,e=u*s.TILE_SIZE+o+24,i=!0,n.draw(t,e,i),t=r+30*s.TILE_SIZE,i=!0,n.draw(t,e,i);for(var p=0;29>p;p++)t=p*s.TILE_SIZE+r+24,e=o,i=!1,n.draw(t,e,i),e=o+20*s.TILE_SIZE,i=!1,n.draw(t,e,i);a.draw(r,o,270),a.draw(r+30*s.TILE_SIZE,o,0),a.draw(r,o+20*s.TILE_SIZE,180),a.draw(r+30*s.TILE_SIZE,o+20*s.TILE_SIZE,90)},L.prototype.createBackGroundEyes=function(){
for(var t=30*s.TILE_SIZE,e=20*s.TILE_SIZE,i=0;i<N[this.stage_no];i++){var n=r+Math.floor(Math.random()*t),h=o+Math.floor(Math.random()*e),c=new a(this);c.init(n,h),this.eyes.push(c)}},L.prototype.calcItemNum=function(){return this.objects_by_tile_type[s.ITEM].length},e.exports=L},{"../constant":2,"../hakurei":5,"../logic/serif/stage1/before":18,"../logic/serif/stage2/before":19,"../logic/serif/stage3/before":20,"../logic/serif/stage4/before":21,"../logic/serif/stage5/before":22,"../object/background_eye":25,"../object/stage_frame1":27,"../object/stage_frame2":28,"../object/tile/block_blue":30,"../object/tile/block_brown":31,"../object/tile/block_green":32,"../object/tile/block_purple":33,"../object/tile/block_red":34,"../object/tile/block_stone1":35,"../object/tile/block_stone2":36,"../object/tile/block_stone3":37,"../object/tile/death":38,"../object/tile/enemy":39,"../object/tile/item":40,"../object/tile/ladder":41,"../object/tile/player":42,"./map/stage1":53,"./map/stage2":54,"./map/stage3":55,"./map/stage4":56,"./map/stage5":57,"./stage/play":60,"./stage/result_clear":62,"./stage/result_gameover":63,"./stage/talk":64}],60:[function(t,e,i){"use strict";var r=t("../../hakurei").scene.base,o=t("../../hakurei").constant,n=t("../../hakurei").util,s=function(t,e){r.apply(this,arguments)};n.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments)},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.isKeyDown(o.BUTTON_LEFT)?this.parent.player().notifyMoveLeft():this.core.isKeyDown(o.BUTTON_RIGHT)?this.parent.player().notifyMoveRight():this.parent.player().notifyNotMove(),this.core.isKeyPush(o.BUTTON_X)&&(this.parent.player().startExchange()?this.core.playSound("boss_powerup"):this.core.playSound("forbidden")),this.parent.player().update()},e.exports=s},{"../../hakurei":5}],61:[function(t,e,i){"use strict";var r=50,o=100,n=t("../../hakurei").scene.base,s=t("../../hakurei").constant,a=t("../../hakurei").util,h=function(t,e){n.apply(this,arguments)};a.inherit(h,n),h.prototype.init=function(){n.prototype.init.apply(this,arguments),this.transitionStartFrame=0},h.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.isTransitionEnd()?this.notifyResultEnd():this.core.isKeyPush(s.BUTTON_Z)&&!this.isInTransition()&&(this.core.playSound("select"),this.setTransition())},h.prototype.isInTransition=function(){return this.transitionStartFrame?!0:!1},h.prototype.isTransitionEnd=function(){return this.isInTransition()&&this.transitionStartFrame+o<this.frame_count},h.prototype.setTransition=function(){this.transitionStartFrame=this.frame_count},h.prototype.draw=function(){var t=this.core.ctx;if(this._showScoreWindow(),this.isInTransition()){t.save();var e=1;e=this.transitionStartFrame+o>=this.frame_count?(this.frame_count-this.transitionStartFrame)/o:1,t.fillStyle="rgb( 0, 0, 0 )",t.globalAlpha=e,t.fillRect(0,0,this.parent.width,this.parent.height),t.restore()}},h.prototype._showScoreWindow=function(){var t=this.core.ctx;t.save();var e=1;e=this.frame_count<o?this.frame_count/o:1,t.fillStyle="rgb(0, 0, 0)",t.globalAlpha=.5*e,t.fillRect(this.parent.width/2-100,this.parent.height/2-140,200,140),t.globalAlpha=e,t.fillStyle="white",t.textAlign="center",t.font="18px 'Migu'",t.fillText(this.resultName(),this.parent.width/2,180),t.fillStyle="white",t.textAlign="left",t.font="16px 'Migu'",Math.floor(this.frame_count/r)%2===0&&(t.textAlign="center",t.fillText(this.resultMessage(),this.parent.width/2,255)),t.restore()},h.prototype.resultName=function(){return""},h.prototype.resultMessage=function(){return""},h.prototype.notifyResultEnd=function(){console.error("notifyResultEnd method must be overridden")},e.exports=h},{"../../hakurei":5}],62:[function(t,e,i){"use strict";var r=t("./result_base"),o=t("../../hakurei").util,n=function(t,e){r.apply(this,arguments)};o.inherit(n,r),n.prototype.notifyResultEnd=function(){this.parent.notifyClearEnd()},n.prototype.resultName=function(){return"STAGE CLEAR !"},n.prototype.resultMessage=function(){return"Press Z to Next"},e.exports=n},{"../../hakurei":5,"./result_base":61}],63:[function(t,e,i){"use strict";var r=t("./result_base"),o=t("../../hakurei").util,n=function(t,e){r.apply(this,arguments)};o.inherit(n,r),n.prototype.notifyResultEnd=function(){this.parent.notifyGameOverEnd()},n.prototype.resultName=function(){return"GAME OVER..."},n.prototype.resultMessage=function(){return"Press Z to Retry"},e.exports=n},{"../../hakurei":5,"./result_base":61}],64:[function(t,e,i){"use strict";var r=10,o=5,n=1,s=t("../../hakurei").scene.base,a=t("../../hakurei").constant,h=t("../../hakurei").util,c=t("../../hakurei").serif_manager,u=function(t){s.apply(this,arguments),this.serif=new c};h.inherit(u,s),u.prototype.init=function(t){s.prototype.init.apply(this,arguments),this.serif.init(t)},u.prototype.beforeDraw=function(){return s.prototype.beforeDraw.apply(this,arguments),this.parent.player().update(),1===this.frame_count&&this.serif.is_end()?void this.parent.changeSubScene("play"):void(this.core.isKeyPush(a.BUTTON_Z)&&(this.serif.is_end()?this.parent.changeSubScene("play"):this.serif.next()))},u.prototype.draw=function(){s.prototype.draw.apply(this,arguments);this.core.ctx;this.serif.right_image()&&this._showRightChara(),this.serif.left_image()&&this._showLeftChara(),this._showMessageWindow(),this._showMessage()},u.prototype._showRightChara=function(){var t=this.core.ctx;t.save();var e=400,i=65;this.serif.is_right_talking()?(e-=o,i-=o):t.globalAlpha=.75;var r=this.core.image_loader.getImage(this.serif.right_image());t.drawImage(r,e,i,r.width*n,r.height*n),t.restore()},u.prototype._showLeftChara=function(){var t=this.core.ctx;t.save();var e=-50,i=25;this.serif.is_left_talking()?(e+=o,i-=o):t.globalAlpha=.75;var r=this.core.image_loader.getImage(this.serif.left_image());t.drawImage(r,e,i,r.width*n,r.height*n),t.restore()},u.prototype._showMessageWindow=function(){var t=this.core.ctx;t.save();var e=100;t.globalAlpha=.5,t.fillStyle="rgb( 0, 0, 0 )",t.fillRect(r,this.core.height-e-r,this.core.width-2*r,e),t.restore()},u.prototype._showMessage=function(){var t=this.core.ctx;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle";var e,i=this.serif.lines();if(i.length){var o=80;e=this.core.height-o+r;for(var n=0,s=i.length;s>n;n++)t.fillStyle="rgb( 0, 0, 0 )",t.lineWidth=4,t.strokeText(i[n],2*r+20,e),t.fillStyle="white",t.fillText(i[n],2*r+20,e),e+=30}t.restore()},e.exports=u},{"../../hakurei":5}],65:[function(t,e,i){"use strict";var r=t("../hakurei").scene.base,o=t("../hakurei").util,n=t("../hakurei").constant,s=100,a=function(t){r.apply(this,arguments)};o.inherit(a,r),a.prototype.init=function(){r.prototype.init.apply(this,arguments),this.core.stopBGM()},a.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),60===this.frame_count&&this.core.playBGM("title"),this.core.isKeyPush(n.BUTTON_Z)&&(this.core.playSound("select"),this.core.changeScene("stage",1,"talk",!0))},a.prototype.draw=function(){this.core.clearCanvas();var t=this.core.ctx;t.save(),this.frame_count<s?t.globalAlpha=this.frame_count/s:t.globalAlpha=1;var e=this.core.image_loader.getImage("title_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.core.width,this.core.height);var i=this.core.image_loader.getImage("title");if(t.drawImage(i,20,-20,i.width,i.height),t.font="38px 'Migu'",t.textAlign="center",this.frame_count%80>40){var r="Press Z to Start";t.fillStyle="rgb( 0, 0, 0 )",t.lineWidth=4,t.strokeText(r,this.core.width/2,420),t.fillStyle="rgb( 255, 255, 255 )",t.fillText(r,this.core.width/2,420)}t.restore()},e.exports=a},{"../hakurei":5}]},{},[23]);